

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Continuum Subtraction &#8212; Reduction Guide</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'step4/step4-continuum-subtraction';</script>
    <link rel="shortcut icon" href="../_static/abaur.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Create final line measurement sets" href="step4-line-mses-achieved.html" />
    <link rel="prev" title="Apply Self-Calibration Solutions" href="step4-apply-self-cal-solutions.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/abaur.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/abaur.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview-resources.html">Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/overview-breakdown.html">Breakdown of Our Task</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 0 - Getting set up</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-download-data.html">Download the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-program-overview.html">Program Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-restoring-pipeline-calibration.html">Restoring the Pipeline Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-weblog.html">Inspecting the Weblog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-dictionaries.html">Useful Dictionaries</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 1 - Prepare the continuum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-manual-flags.html">Manual Flagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-pseudo-continuum.html">Pseudocontinuum Measurement Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-initial-continuum-images.html">Initial Continuum Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-initial-self-calibration.html">Initial Self-Calibration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 2 - Phase alignment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step2/step2-align-LBs.html">Align Long-Baseline Execution Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step2/step2-align-SBs.html">Align Short-Baseline Execution Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step2/step2-summary-of-shifts.html">Summary of Phase Shifts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 3 - Self-calibration of the continuum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step3/step3-selfcal-SBs.html">Self-Calibration of Short-Baseline Execution Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step3/step3-selfcal-SBs%2BLBs.html">Self-Calibration of SB+LB data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step3/step3-continuum-ms-achieved.html">Create final continuum measurement set</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 4 - Prepare the lines</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="step4-manual-flags.html">Manual Flagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="step4-split-spws.html">Splitting Out Line Spectral Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="step4-apply-phase-alignments.html">Apply Phase Shifts</a></li>
<li class="toctree-l1"><a class="reference internal" href="step4-apply-self-cal-solutions.html">Apply Self-Calibration Solutions</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Continuum Subtraction</a></li>

<li class="toctree-l1"><a class="reference internal" href="step4-line-mses-achieved.html">Create final line measurement sets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Imaging - Continuum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../imaging-cont/imaging-cont-procedure.html">Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-cont/imaging-cont-preliminary-images.html">Preliminary Images</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Imaging - Lines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-procedure.html">Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-dirty-images.html">Dirty Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-initial-approaches.html">Initial Approaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-adopted-approach.html">Adopted Approach</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jjspeedie/guide.2021.1.00690.S" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jjspeedie/guide.2021.1.00690.S/issues/new?title=Issue%20on%20page%20%2Fstep4/step4-continuum-subtraction.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/step4/step4-continuum-subtraction.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Continuum Subtraction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Continuum Subtraction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#velocity-re-gridding">Velocity re-gridding</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"></a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tip admonition">
<p class="admonition-title">Scripts for <strong>Step 4 - Prepare the lines</strong>:</p>
<ul class="simple">
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/step4_prepare_lines.py" target="_blank">step4_prepare_lines.py</a> # main script</p></li>
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/step4_detour.py" target="_blank">step4_detour.py</a> # for phase alignment</p></li>
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/dictionary_data.py" target="_blank">dictionary_data.py</a> # loads data_dict</p></li>
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/dictionary_disk.py" target="_blank">dictionary_disk.py</a> # loads disk_dict</p></li>
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/step1_utils.py" target="_blank">step1_utils.py</a> # loads multiple functions</p></li>
<li><p><a href="https://casaguides.nrao.edu/index.php/Analysis_Utilities" target="_blank">analysisUtils (analysis_scripts/)</a> # for channel strings</p></li>
</ul>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="continuum-subtraction">
<h1>Continuum Subtraction<a class="headerlink" href="#continuum-subtraction" title="Permalink to this heading">#</a></h1>
<p>Performed in uv-space with CASA task uvcontsub. Here is the before-and-after, for SB EB 1, for spectral windows SO, C18O, 13CO, 12CO (left to right):</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Continuum subtraction: SB EB 1</div>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw1.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw1.gif" style="width: 24%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw2.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw2.gif" style="width: 24%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw3.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw3.gif" style="width: 24%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw4.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_SB_EB1_initlines_selfcal_contsub_spw4.gif" style="width: 24%;" /></a>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Amplitude vs. channel, before and after continuum subtraction. Channels used to fit the continuum are the inverse of those used to flag the spectral lines in Step 1. Showing SB EB1. Notice in the case of the SO spectral window (left), the y-axis values change (0.06 to 0.04).</p>
</div>
</div>
<p>The results for the other EBs are similar, although none that look as clear as SB EB1. Here for example is LB EB5:</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Continuum subtraction: LB EB 5</div>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw1.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw1.gif" style="width: 24%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw2.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw2.gif" style="width: 24%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw3.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw3.gif" style="width: 24%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw4.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/ABAur_LB_EB5_initlines_selfcal_contsub_spw4.gif" style="width: 24%;" /></a>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">I’m a bit concerned about the 13CO spectral window here (2nd from right). Notice the y-axis changes from 0.6 to 0.07. The amplitude of the line significantly decreases. This could just be an averaging trick (these plots were made with avgtime=’1e8’, avgscan=True and avgbaseline=True), but I’m not sure. Before uvcontsub, the line doesn’t look “empty”. What can I do about this?</p>
</div>
</div>
<p>For the record, here are the spectral windows used to fit the continuum (“fitspw”):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">SB_EB1</span><span class="p">:</span> <span class="s1">&#39;1:517~589,       2:504~600,       3:961~1251,        4:556~1059&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">516</span><span class="p">;</span><span class="mi">590</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">503</span><span class="p">;</span><span class="mi">601</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">960</span><span class="p">;</span><span class="mi">1252</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">555</span><span class="p">;</span><span class="mi">1060</span><span class="o">~</span><span class="mi">1919</span>
<span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">SB_EB2</span><span class="p">:</span> <span class="s1">&#39;1:517~589,       2:504~600,       3:962~1251,        4:554~1058&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">516</span><span class="p">;</span><span class="mi">590</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">503</span><span class="p">;</span><span class="mi">601</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">961</span><span class="p">;</span><span class="mi">1252</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">553</span><span class="p">;</span><span class="mi">1059</span><span class="o">~</span><span class="mi">1919</span>
<span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">LB_EB1</span><span class="p">:</span> <span class="s1">&#39;1:516~589,       2:504~600,       3:960~1249,        4:553~1057&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">515</span><span class="p">;</span><span class="mi">590</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">503</span><span class="p">;</span><span class="mi">601</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">959</span><span class="p">;</span><span class="mi">1250</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">552</span><span class="p">;</span><span class="mi">1058</span><span class="o">~</span><span class="mi">1919</span>
<span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">LB_EB2</span><span class="p">:</span> <span class="s1">&#39;1:517~589,       2:504~600,       3:960~1249,        4:553~1057&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">516</span><span class="p">;</span><span class="mi">590</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">503</span><span class="p">;</span><span class="mi">601</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">959</span><span class="p">;</span><span class="mi">1250</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">552</span><span class="p">;</span><span class="mi">1058</span><span class="o">~</span><span class="mi">1919</span>
<span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">LB_EB3</span><span class="p">:</span> <span class="s1">&#39;1:517~589,       2:505~601,       3:960~1249,        4:553~1057&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">516</span><span class="p">;</span><span class="mi">590</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">504</span><span class="p">;</span><span class="mi">602</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">959</span><span class="p">;</span><span class="mi">1250</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">552</span><span class="p">;</span><span class="mi">1058</span><span class="o">~</span><span class="mi">1919</span>
<span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">LB_EB4</span><span class="p">:</span> <span class="s1">&#39;1:516~589,       2:504~600,       3:960~1249,        4:553~1057&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">515</span><span class="p">;</span><span class="mi">590</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">503</span><span class="p">;</span><span class="mi">601</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">959</span><span class="p">;</span><span class="mi">1250</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">552</span><span class="p">;</span><span class="mi">1058</span><span class="o">~</span><span class="mi">1919</span>
<span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">LB_EB5</span><span class="p">:</span> <span class="s1">&#39;1:516~588,       2:504~600,       3:960~1250,        4:553~1057&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">515</span><span class="p">;</span><span class="mi">589</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">503</span><span class="p">;</span><span class="mi">601</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">959</span><span class="p">;</span><span class="mi">1251</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">552</span><span class="p">;</span><span class="mi">1058</span><span class="o">~</span><span class="mi">1919</span>
<span class="n">Flagchannels</span> <span class="nb">input</span> <span class="n">string</span> <span class="k">for</span> <span class="n">LB_EB6</span><span class="p">:</span> <span class="s1">&#39;1:517~589,       2:505~601,       3:960~1249,        4:553~1057&#39;</span>
                              <span class="n">fitspw</span><span class="p">:</span>  <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">516</span><span class="p">;</span><span class="mi">590</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">504</span><span class="p">;</span><span class="mi">602</span><span class="o">~</span><span class="mi">959</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">959</span><span class="p">;</span><span class="mi">1250</span><span class="o">~</span><span class="mi">1919</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="o">~</span><span class="mi">552</span><span class="p">;</span><span class="mi">1058</span><span class="o">~</span><span class="mi">1919</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="velocity-re-gridding">
<h1>Velocity re-gridding<a class="headerlink" href="#velocity-re-gridding" title="Permalink to this heading">#</a></h1>
<p>What I didn’t realize beforehand is that cvel2 cannot regrid a measurement set that contains multiple spectral windows all at the same time. So I split each spectral window out of each execution block (both the continuum subtracted and non-continuum subtracted versions), and regridded them individually.</p>
<p>A listobs nicely shows that they’ve been successfully regridded. Here for example is the LB EB1 spectral window for SO, before and after the cvel2 task. Notice “Frame” changes from TOPO to LSRK:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Spectral</span> <span class="n">Windows</span><span class="p">:</span>  <span class="p">(</span><span class="mi">1</span> <span class="n">unique</span> <span class="n">spectral</span> <span class="n">windows</span> <span class="ow">and</span> <span class="mi">1</span> <span class="n">unique</span> <span class="n">polarization</span> <span class="n">setups</span><span class="p">)</span>
  <span class="n">SpwID</span>  <span class="n">Name</span>                                       <span class="c1">#Chans   Frame   Ch0(MHz)  ChanWid(kHz)  TotBW(kHz) CtrFreq(MHz) BBC Num  Corrs</span>
  <span class="mi">0</span>      <span class="n">X2090867609</span><span class="c1">#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   TOPO  219985.475       -61.035     58593.8 219956.2084        1  XX  YY</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Spectral</span> <span class="n">Windows</span><span class="p">:</span>  <span class="p">(</span><span class="mi">1</span> <span class="n">unique</span> <span class="n">spectral</span> <span class="n">windows</span> <span class="ow">and</span> <span class="mi">1</span> <span class="n">unique</span> <span class="n">polarization</span> <span class="n">setups</span><span class="p">)</span>
  <span class="n">SpwID</span>  <span class="n">Name</span>                                       <span class="c1">#Chans   Frame   Ch0(MHz)  ChanWid(kHz)  TotBW(kHz) CtrFreq(MHz) BBC Num  Corrs</span>
  <span class="mi">0</span>      <span class="n">X2090867609</span><span class="c1">#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   LSRK  219978.920       -61.033     58592.0 219949.6544        1  XX  YY</span>
</pre></div>
</div>
<p>Looking at the channel frequencies in each execution block and each spectral window, before and after regridding:</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<a class="mb-1 reference internal image-reference" href="../_images/cvel2-before-after-spw0.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/cvel2-before-after-spw0.gif" style="width: 99%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/cvel2-before-after-spw1.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/cvel2-before-after-spw1.gif" style="width: 99%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/cvel2-before-after-spw2.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/cvel2-before-after-spw2.gif" style="width: 99%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/cvel2-before-after-spw3.gif"><img alt="SB_contsub_spw1" class="mb-1" src="../_images/cvel2-before-after-spw3.gif" style="width: 99%;" /></a>
</div>
</div>
<section id="id1">
<h2><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Re-investigating the effect of cvel2 velocity regridding<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">I was interested to know whether cvel2 had aligned the channel frequencies perfectly (or at least, to within a channel width). For example, here’s the Spectral Window section of the listobs output for ABAur_SO.bin30s.ms.cvel2:</p>
<p class="sd-card-text">Spectral Windows:  (8 unique spectral windows and 1 unique polarization setups)
SpwID  Name                                       #Chans   Frame   Ch0(MHz)  ChanWid(kHz)  TotBW(kHz) CtrFreq(MHz) BBC Num  Corrs
0      X392063246#ALMA_RB_06#BB_1#SW-01#FULL_RES     960   LSRK  219978.952       -61.041     58599.8 219949.6829        1  XX  YY
1      X392063246#ALMA_RB_06#BB_1#SW-01#FULL_RES     960   LSRK  219978.944       -61.039     58597.7 219949.6754        1  XX  YY
2      X2090867609#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   LSRK  219978.920       -61.033     58592.0 219949.6544        1  XX  YY
3      X2090867609#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   LSRK  219978.925       -61.033     58591.8 219949.6595        1  XX  YY
4      X2090867609#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   LSRK  219978.934       -61.033     58591.8 219949.6688        1  XX  YY
5      X2090867609#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   LSRK  219978.918       -61.033     58591.7 219949.6531        1  XX  YY
6      X2090867609#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   LSRK  219978.909       -61.033     58591.6 219949.6434        1  XX  YY
7      X2090867609#ALMA_RB_06#BB_1#SW-01#FULL_RES    960   LSRK  219978.936       -61.033     58591.6 219949.6707        1  XX  YY</p>
<p class="sd-card-text">Looking at the frequency of the first channel (column Ch0), I see that the difference between Ch0 of SB EB1 (first row) and Ch0 of the other EBs is: -8 kHz, -32 kHz, -27 kHz, -18 kHz, -34 kHz, -43 kHz, and -16 kHz. So I guess you could say they are all aligned to within a channel width (61 kHz).
Doing the same exercise for the ABAur_13CO.bin30s.ms.cvel2:</p>
<p class="sd-card-text">SpwID  Name                                       #Chans   Frame   Ch0(MHz)  ChanWid(kHz)  TotBW(kHz) CtrFreq(MHz) BBC Num  Corrs
0      X392063246#ALMA_RB_06#BB_2#SW-01#FULL_RES    1920   LSRK  220428.185       -30.521     58599.8 220398.9008        2  XX  YY
1      X392063246#ALMA_RB_06#BB_2#SW-01#FULL_RES    1920   LSRK  220428.186       -30.520     58597.7 220398.9022        2  XX  YY
2      X2090867609#ALMA_RB_06#BB_2#SW-01#FULL_RES   1920   LSRK  220428.133       -30.517     58592.0 220398.8520        2  XX  YY
3      X2090867609#ALMA_RB_06#BB_2#SW-01#FULL_RES   1920   LSRK  220428.136       -30.517     58591.8 220398.8557        2  XX  YY
4      X2090867609#ALMA_RB_06#BB_2#SW-01#FULL_RES   1920   LSRK  220428.145       -30.517     58591.8 220398.8647        2  XX  YY
5      X2090867609#ALMA_RB_06#BB_2#SW-01#FULL_RES   1920   LSRK  220428.129       -30.517     58591.7 220398.8485        2  XX  YY
6      X2090867609#ALMA_RB_06#BB_2#SW-01#FULL_RES   1920   LSRK  220428.149       -30.516     58591.6 220398.8684        2  XX  YY
7      X2090867609#ALMA_RB_06#BB_2#SW-01#FULL_RES   1920   LSRK  220428.146       -30.516     58591.6 220398.8654        2  XX  YY</p>
<p class="sd-card-text">The difference in Ch0 between EBs is: 1 kHz, -52 kHz, -49 kHz, -40 kHz, -56 kHz, -36 kHz, and -39 kHz. All but one of these differences are larger than the channel width (30 kHz). Is this concerning?</p>
</div>
</details></section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./step4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="step4-apply-self-cal-solutions.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Apply Self-Calibration Solutions</p>
      </div>
    </a>
    <a class="right-next"
       href="step4-line-mses-achieved.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Create final line measurement sets</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Continuum Subtraction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#velocity-re-gridding">Velocity re-gridding</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"></a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jess Speedie
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>