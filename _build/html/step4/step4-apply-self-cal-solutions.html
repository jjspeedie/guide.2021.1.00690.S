

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Apply Self-Calibration Solutions &#8212; Reduction Guide</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'step4/step4-apply-self-cal-solutions';</script>
    <link rel="shortcut icon" href="../_static/abaur.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Continuum Subtraction" href="step4-continuum-subtraction.html" />
    <link rel="prev" title="Apply Phase Shifts" href="step4-apply-phase-alignments.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/abaur.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/abaur.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview-resources.html">Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/overview-breakdown.html">Breakdown of Our Task</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 0 - Getting set up</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-download-data.html">Download the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-program-overview.html">Program Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-weblog.html">Inspecting the Weblog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-restoring-pipeline-calibration.html">Restoring the Pipeline Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step0/step0-dictionaries.html">Useful Dictionaries</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 1 - Prepare the continuum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-summary.html">Step 1 Overview &amp; Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-manual-flags.html">Manual Flagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-pseudo-continuum.html">Pseudo-continuum Measurement Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-initial-continuum-images.html">Initial Continuum Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step1/step1-initial-self-calibration.html">Initial Self-Calibration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 2 - Phase alignment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step2/step2-summary.html">Step 2 Overview &amp; Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step2/step2-align-LBs.html">Align Long-Baseline Execution Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step2/step2-align-SBs.html">Align Short-Baseline Execution Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step2/step2-summary-of-shifts.html">Summary of Phase Shifts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 3 - Self-calibration of the continuum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../step3/step3-summary.html">Step 3 Overview &amp; Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step3/step3-selfcal-SBs.html">Self-Calibration of Short-Baseline Execution Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step3/step3-selfcal-SBs%2BLBs.html">Self-Calibration of SB+LB Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../step3/step3-continuum-ms-achieved.html">Create Final Continuum Measurement Set</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Step 4 - Prepare the lines</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="step4-summary.html">Step 4 Overview &amp; Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="step4-average-down-continuum.html">Averaging Down the Continuum</a></li>
<li class="toctree-l1"><a class="reference internal" href="step4-apply-phase-alignments.html">Apply Phase Shifts</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Apply Self-Calibration Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="step4-continuum-subtraction.html">Continuum Subtraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="step4-line-mses-achieved.html">Create Final Line Measurement Sets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Imaging - Continuum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../imaging-cont/imaging-cont-procedure.html">Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-cont/imaging-cont-preliminary-images.html">Preliminary Images</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Imaging - Lines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-procedure.html">Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-dirty-images.html">Dirty Image Cubes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-initial-approaches.html">Initial Approaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imaging-lines/imaging-lines-adopted-approach.html">Adopted Approach</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Wrap-up</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../science/science-wrap-up.html">Now on to the science!</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jjspeedie/guide.2021.1.00690.S" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jjspeedie/guide.2021.1.00690.S/issues/new?title=Issue%20on%20page%20%2Fstep4/step4-apply-self-cal-solutions.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/step4/step4-apply-self-cal-solutions.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Apply Self-Calibration Solutions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tip admonition">
<p class="admonition-title">Scripts for <strong>Step 4 - Prepare the lines</strong>:</p>
<ul class="simple">
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/step4_prepare_lines.py" target="_blank">step4_prepare_lines.py</a> # main script</p></li>
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/step4_detour.py" target="_blank">step4_detour.py</a> # for phase alignment</p></li>
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/dictionary_data.py" target="_blank">dictionary_data.py</a> # loads data_dict</p></li>
<li><p><a href="https://github.com/jjspeedie/workflow.2021.1.0690.S/blob/main/step1_utils.py" target="_blank">step1_utils.py</a> # loads multiple functions</p></li>
<li><p><a href="https://casaguides.nrao.edu/index.php/Analysis_Utilities" target="_blank">analysisUtils (analysis_scripts/)</a> # for channel strings</p></li>
</ul>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="apply-self-calibration-solutions">
<h1>Apply Self-Calibration Solutions<a class="headerlink" href="#apply-self-calibration-solutions" title="Permalink to this heading">#</a></h1>
<p>At this point, we have eight phase-aligned EBs (6 LBs and 2 SBs) with suffix <code class="docutils literal notranslate"><span class="pre">_initlines_shift.ms</span></code>, containing our line data. Each EB has the four line spectral windows (SPW 1-4). The averaged-down continuum spectral window (SPW 0) is also still tagging along for the ride.</p>
<p>We now wish to <em>apply</em> the calibration solutions that we generated from the continuum self-calibration in <a class="reference internal" href="../step3/step3-summary.html"><span class="doc std std-doc">Step 3</span></a>. The calibration solutions are in calibration tables. Each one contains information that the others do not, so we need to apply them all, and in the same succession as they were generated.</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p class="sd-card-text">Calibration tables generated using <a class="reference internal" href="../step3/step3-selfcal-SBs.html"><span class="doc std std-doc">short-baseline data only</span></a></p></th>
<th class="head"><p class="sd-card-text">Calibration tables generated using <a class="reference internal" href="../step3/step3-selfcal-SBs%2BLBs.html"><span class="doc std std-doc">concatenated short-baseline + long-baseline data</span></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p class="sd-card-text">SB_contp1.cal</p></td>
<td><p class="sd-card-text">BB_contp1.cal</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">SB_contp2.cal</p></td>
<td><p class="sd-card-text">BB_contp2.cal</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">SB_contp3.cal</p></td>
<td><p class="sd-card-text">BB_contp3.cal</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">SB_contp4.cal</p></td>
<td><p class="sd-card-text">BB_contp4.cal</p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">SB_contp5.cal</p></td>
<td><p class="sd-card-text">BB_contap.cal</p></td>
</tr>
<tr class="row-odd"><td><p class="sd-card-text">SB_contp6.cal</p></td>
<td><p class="sd-card-text"></p></td>
</tr>
<tr class="row-even"><td><p class="sd-card-text">SB_contap.cal</p></td>
<td><p class="sd-card-text"></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text"><strong>Left column:</strong> The calibration tables we generated from the <a class="reference internal" href="../step3/step3-selfcal-SBs.html"><span class="doc std std-doc">short-baseline data only</span></a>. <strong>Right column:</strong> The calibration tables we generated from the <a class="reference internal" href="../step3/step3-selfcal-SBs%2BLBs.html"><span class="doc std std-doc">concatenated short-baseline + long-baseline data</span></a> (“BB” stands for “both baselines”).</p>
</div>
</div>
<p>It would be most intuitive to concatenate the SB line data (i.e., concatenate the two short baseline <code class="docutils literal notranslate"><span class="pre">_initlines_shift.ms</span></code> measurement sets), and then apply each of the calibration tables in the left column above (<code class="docutils literal notranslate"><span class="pre">SB_contp1.cal</span></code>, then <code class="docutils literal notranslate"><span class="pre">SB_contp2.cal</span></code>, and so on) – <em>and then</em> concatenate that resulting SB data with the LB data (i.e., the six long baseline <code class="docutils literal notranslate"><span class="pre">_initlines_shift.ms</span></code> measurement sets), and apply the self calibration tables in the right column above (<code class="docutils literal notranslate"><span class="pre">BB_contp1.cal</span></code>, then <code class="docutils literal notranslate"><span class="pre">BB_contp2.cal</span></code>, and so on) to that single giant measurement set. However, concatenating would use <em>a lot</em> of disk space (each MS is ~50 GB), and it would take <code class="docutils literal notranslate"><span class="pre">applycal</span></code> a lot of time to apply the solutions. As such, we keep the data in their separate execution blocks, and then at <a class="reference internal" href="step4-line-mses-achieved.html"><span class="doc std std-doc">the very end</span></a>, split out each spectral window and combine the corresponding spectral windows across executions.</p>
<p>Doing it this way, we face one complication: We generated our self calibration tables using concatenated data. This means that each calibration table is big, and contains solutions for multiple EBs. We need to apply each calibration table to only a subset of the data it was generated with. Below is a visual representation of the situation.</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<center>
<a class="mb-1 reference internal image-reference" href="../_images/step4_difficulty.jpg"><img alt="step4_difficulty" class="mb-1" src="../_images/step4_difficulty.jpg" style="width: 100%;" /></a>
</center>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">We want a way to reference only a certain portion of each calibration table in order to apply that portion to each corresponding EB separately.</p>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">applycal</span></code> task <code class="docutils literal notranslate"><span class="pre">spwmap</span></code> parameter lets us take only a subset of the <em>spectral windows</em> contained within a calibration table, and apply those to the input MS. The trick is knowing how the mapping will work, because it requires accounting for the rounds where the  <code class="docutils literal notranslate"><span class="pre">combine='spw'</span></code> parameter was or wasn’t set during <code class="docutils literal notranslate"><span class="pre">gaincal</span></code>. For example, compare these two SB calibration tables:</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<a class="mb-1 reference internal image-reference" href="../_images/step4_difficulty_SB_p1.png"><img alt="step4_difficulty_SB_p1" class="mb-1" src="../_images/step4_difficulty_SB_p1.png" style="width: 49%;" /></a>
<a class="mb-1 reference internal image-reference" href="../_images/step4_difficulty_SB_p4.png"><img alt="step4_difficulty_SB_p4" class="mb-1" src="../_images/step4_difficulty_SB_p4.png" style="width: 49%;" /></a>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text"><strong>Left:</strong> Spectral windows were <u>not</u> combined (<code class="docutils literal notranslate"><span class="pre">combine=''</span></code>). <strong>Right:</strong> Spectral windows <u>were</u> combined (<code class="docutils literal notranslate"><span class="pre">combine='spw'</span></code>). In both cases, notice the spectral window indexing in the calibration tables (grey boxes), and where it comes from.</p>
</div>
</div>
<p>The same idea applies for the BB (SB+LB) calibration tables. Here is the same information but presented a different way:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">SB_contp1.cal was gained on SB1 and SB2 with combine=&#39;&#39;, so it contains spws [0,1,2,3,4,5,6,7,8,9]</span>
<span class="go">If we want to apply it to SB 1 (lines) only, we need spwmap=[0,1,2,3,4]</span>
<span class="go">                   and to SB 2 (lines) only, we need spwmap=[5,6,7,8,9]</span>

<span class="go">SB_contp3.cal was gained on SB1 and SB2 with combine=&#39;spw&#39;, so it contains spws [0,0,0,0,0,5,5,5,5,5]</span>
<span class="go">If we want to apply it to SB 1 (lines) only, we need spwmap=[0,0,0,0,0]</span>
<span class="go">                   and to SB 2 (lines) only, we need spwmap=[5,5,5,5,5]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">applycal</span></code> task has another very useful parameter, <code class="docutils literal notranslate"><span class="pre">gaintable</span></code>, which we use to apply multiple calibration solutions in one call, but still in succession.</p>
<p>So with all that in mind, these are the required lists and combinations:</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<center>
<a class="mb-1 reference internal image-reference" href="../_images/step4_difficulty_workflow_SB.png"><img alt="step4_difficulty_workflow_SB" class="mb-1" src="../_images/step4_difficulty_workflow_SB.png" style="width: 100%;" /></a>
</center>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Combination of <code class="docutils literal notranslate"><span class="pre">gaintable</span></code> and <code class="docutils literal notranslate"><span class="pre">spwmap</span></code> parameters to be used in the <code class="docutils literal notranslate"><span class="pre">applycal</span> <span class="pre">task</span></code> for self calibration of each of the SB line measurement sets.</p>
</div>
</div>
<!-- ```{figure} images/step4_difficulty_workflow_SB.png
:alt: applying-calibration-tables
:class: mb-1
:width: 100%
:align: center
Combination of gaintable and spwmap parameters to be used in the applycal task for self calibration of each of the SB line measurement sets.
``` -->
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<center>
<a class="mb-1 reference internal image-reference" href="../_images/step4_difficulty_workflow_BB.png"><img alt="step4_difficulty_workflow_BB" class="mb-1" src="../_images/step4_difficulty_workflow_BB.png" style="width: 100%;" /></a>
</center>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text">Combination of <code class="docutils literal notranslate"><span class="pre">gaintable</span></code> and <code class="docutils literal notranslate"><span class="pre">spwmap</span></code> parameters to be used in the <code class="docutils literal notranslate"><span class="pre">applycal</span></code> task for self calibration of each of the SB+LB line measurement sets.</p>
</div>
</div>
<!-- ```{figure} images/step4_difficulty_workflow_BB.png
:alt: applying-calibration-tables
:class: mb-1
:width: 100%
:align: center
Combination of gaintable and spwmap parameters to be used in the applycal task for self calibration of each of the SB and LB line measurement sets.
``` -->
<p>We do two “runs” of <code class="docutils literal notranslate"><span class="pre">applycal</span></code>; the first to apply the SB calibration tables, and the second to apply the SB+LB calibration tables. These are done separately (we do not feed in an uber <code class="docutils literal notranslate"><span class="pre">gaintable</span></code> and <code class="docutils literal notranslate"><span class="pre">spwmap</span></code> list) so that the <code class="docutils literal notranslate"><span class="pre">applymode</span></code> parameter can be set differently in the two cases. In the former, <code class="docutils literal notranslate"><span class="pre">applymode='calflag'</span></code> (calibrate and flag), and in the latter, <code class="docutils literal notranslate"><span class="pre">applymode</span> <span class="pre">=</span> <span class="pre">'calonly'</span></code> (calibrate only).</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./step4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="step4-apply-phase-alignments.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Apply Phase Shifts</p>
      </div>
    </a>
    <a class="right-next"
       href="step4-continuum-subtraction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Continuum Subtraction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jess Speedie
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>